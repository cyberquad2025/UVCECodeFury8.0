<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AgriMitra | Crop Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root {--green:#2d6a4f; --dark:#1b4332; --light:#d8f3dc; --bg:#f6fff9;}
*{box-sizing:border-box;}
body{margin:0; font-family:Segoe UI,Arial; background:var(--bg); color:#222; transition: background 0.3s;}

/* Navbar */
nav{display:flex; justify-content:space-between; align-items:center;
    background:var(--green); color:#fff; padding:12px 20px; position:relative; transition: background 0.3s;}
.logo{font-weight:bold; font-size:20px;}
nav ul{list-style:none; display:flex; gap:20px; margin:0; padding:0; transition: all 0.3s;}
nav a{color:#fff; text-decoration:none; font-weight:500; transition: color 0.3s;}
nav a:hover{text-decoration:underline;}
.menu-toggle{display:none; font-size:26px; cursor:pointer;}
@media(max-width:768px){
  nav ul{display:none; flex-direction:column; gap:14px; background:rgba(0,0,0,0.9);
         position:absolute; top:100%; left:0; width:100%; padding:18px 0; text-align:center;}
  nav ul.show{display:flex;}
  .menu-toggle{display:block;}
}

/* Container */
.container{max-width:1100px; margin:20px auto; padding:20px; display:flex; gap:20px; transition: all 0.3s;}

/* Sidebar */
.sidebar{flex:0 0 220px; background:#fff; border-radius:12px; padding:20px;
         box-shadow:0 4px 12px rgba(0,0,0,0.08); height:fit-content; transition: all 0.3s;}
.sidebar h3{margin-top:0; color:var(--green);}
.sidebar ul{list-style:none; padding:0; margin:0;}
.sidebar li{margin:10px 0;}
.sidebar a{text-decoration:none; color:#333; font-weight:500; transition: color 0.3s;}
.sidebar a:hover{color:var(--green);}

/* Main */
.main{flex:1; display:flex; flex-direction:column; gap:20px;}
.card{background:#fff; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s;}
.card:hover{transform:translateY(-4px); box-shadow:0 8px 20px rgba(0,0,0,0.12);}
.card h1{margin-top:0; color:var(--green);}

/* Crops */
.crops{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px;}
.crop-card{background:#f8fdf7; padding:16px; border-radius:10px; border:1px solid #eee;
           display:flex; flex-direction:column; justify-content:space-between; opacity:0; transform:translateY(20px);
           animation: fadeInUp 0.6s forwards; transition: transform 0.3s, box-shadow 0.3s;}
.crop-card:hover{transform:translateY(-4px); box-shadow:0 6px 16px rgba(0,0,0,0.1);}
.crop-card h3{margin:0 0 8px; color:var(--green);}
.crop-card small{color:#666;}
.price{font-weight:bold; margin:8px 0;}
.btn{background:var(--green); color:#fff; border:none; padding:10px; border-radius:6px;
     cursor:pointer; font-size:14px; font-weight:500; transition:0.3s;}
.btn:hover{background:var(--dark);}

@keyframes fadeInUp{
  0%{opacity:0; transform:translateY(20px);}
  100%{opacity:1; transform:translateY(0);}
}

/* Responsive */
@media(max-width:900px){ .container{flex-direction:column;} .sidebar{flex:none;} }
</style>
</head>
<body>

<nav>
  <div class="logo">ЁЯМ╛ AgriMitra</div>
  <span class="menu-toggle" onclick="toggleMenu()">тШ░</span>
  <ul id="navbar-links"></ul>
  <select id="langSelect" onchange="changeLanguage()" style="padding:6px;border-radius:6px;font-weight:600;">
    <option value="en">English</option>
    <option value="hi">рд╣рд┐рдиреНрджреА</option>
    <option value="ta">родрооро┐ро┤рпН</option>
    <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
    <option value="kn">р▓Хр▓ир│Нр▓ир▓б</option>
  </select>
</nav>

<div class="container">
  <div class="sidebar">
    <h3 id="sidebar-title">Marketplace Menu</h3>
    <ul>
      <li><a href="#crops" id="sidebar-all-crops">ЁЯМ▒ All Crops</a></li>
      <li><a href="buyer.html#orders" id="sidebar-my-orders">ЁЯУж My Orders</a></li>
      <li><a href="buyer.html#insights" id="sidebar-insights">ЁЯУК Market Insights</a></li>
    </ul>
  </div>

  <div class="main">
    <div class="card" id="crops">
      <h1 id="main-title">Crop Marketplace</h1>
      <p id="main-lead">Browse and order fresh crops directly from farmers</p>
      <div id="list" class="crops">Loading crops...</div>
    </div>
  </div>
</div>

<script>
const API = "http://127.0.0.1:5000";
let user = JSON.parse(localStorage.getItem("user")||"{}");

const translations = {
  en: { nav_home:"Home", nav_dashboard:"Dashboard", nav_equipment:"Equipment", nav_logout:"Logout", nav_login:"Login", nav_register:"Register", sidebar_title:"Marketplace Menu", sidebar_all_crops:"ЁЯМ▒ All Crops", sidebar_my_orders:"ЁЯУж My Orders", sidebar_insights:"ЁЯУК Market Insights", main_title:"Crop Marketplace", main_lead:"Browse and order fresh crops directly from farmers", loading_crops:"Loading crops...", no_crops:"No crops listed yet.", farmer:"ЁЯСитАНЁЯМ╛ Farmer: ", place_order:"Place Order", alert_login_order:"Please login to place order"},
  hi: { nav_home:"рд╣реЛрдо", nav_dashboard:"рдбреИрд╢рдмреЛрд░реНрдб", nav_equipment:"рдЙрдкрдХрд░рдг", nav_logout:"рд▓реЙрдЧрдЖрдЙрдЯ", nav_login:"рд▓реЙрдЧрд┐рди", nav_register:"рд░рдЬрд┐рд╕реНрдЯрд░", sidebar_title:"рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕ рдореЗрдиреНрдпреВ", sidebar_all_crops:"ЁЯМ▒ рд╕рднреА рдлрд╕рд▓реЗрдВ", sidebar_my_orders:"ЁЯУж рдореЗрд░реЗ рдСрд░реНрдбрд░реНрд╕", sidebar_insights:"ЁЯУК рдорд╛рд░реНрдХреЗрдЯ рдЗрдирд╕рд╛рдЗрдЯреНрд╕", main_title:"рдлрд╕рд▓ рдорд╛рд░реНрдХреЗрдЯрдкреНрд▓реЗрд╕", main_lead:"рдХрд┐рд╕рд╛рдиреЛрдВ рд╕реЗ рд╕реАрдзреЗ рддрд╛рдЬрд╝реА рдлрд╕рд▓реЗрдВ рджреЗрдЦреЗрдВ рдФрд░ рдСрд░реНрдбрд░ рдХрд░реЗрдВ", loading_crops:"рдлрд╕рд▓реЗрдВ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ...", no_crops:"рдХреЛрдИ рдлрд╕рд▓ рд╕реВрдЪреАрдмрджреНрдз рдирд╣реАрдВ рд╣реИред", farmer:"ЁЯСитАНЁЯМ╛ рдХрд┐рд╕рд╛рди: ", place_order:"рдСрд░реНрдбрд░ рдХрд░реЗрдВ", alert_login_order:"рдСрд░реНрдбрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ"},
  ta: { nav_home:"роорпБроХрокрпНрокрпБ", nav_dashboard:"роЯро╛ро╖рпНрокрпЛро░рпНроЯрпБ", nav_equipment:"роЪро╛родройроЩрпНроХро│рпН", nav_logout:"ро╡рпЖро│ро┐ропрпЗро▒рпБ", nav_login:"роЙро│рпНроирпБро┤рпИ", nav_register:"рокродро┐ро╡рпБ роЪрпЖропрпН", sidebar_title:"роЪроирпНродрпИрокрпКро░рпБро│рпН роорпЖройрпБ", sidebar_all_crops:"ЁЯМ▒ роЕройрпИродрпНродрпБ рокропро┐ро░рпНроХро│рпН", sidebar_my_orders:"ЁЯУж роОройродрпБ роЖро░рпНроЯро░рпНроХро│рпН", sidebar_insights:"ЁЯУК роЪроирпНродрпИ роирпБрогрпНрогро▒ро┐ро╡рпБроХро│рпН", main_title:"рокропро┐ро░рпН роЪроирпНродрпИ", main_lead:"ро╡ро┐ро╡роЪро╛ропро┐роХро│ро┐роЯрооро┐ро░рпБроирпНродрпБ роирпЗро░роЯро┐ропро╛роХ рокрпБродро┐роп рокропро┐ро░рпНроХро│рпИ роЙро▓ро╛ро╡ро╡рпБроорпН рооро▒рпНро▒рпБроорпН роЖро░рпНроЯро░рпН роЪрпЖропрпНропро╡рпБроорпН", loading_crops:"рокропро┐ро░рпНроХро│рпН роПро▒рпНро▒рокрпНрокроЯрпБроХро┐ройрпНро▒рой...", no_crops:"роЗродрпБро╡ро░рпИ роОроирпНрод рокропро┐ро░рпНроХро│рпБроорпН рокроЯрпНроЯро┐ропро▓ро┐роЯрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.", farmer:"ЁЯСитАНЁЯМ╛ ро╡ро┐ро╡роЪро╛ропро┐: ", place_order:"роЖро░рпНроЯро░рпН роЪрпЖропрпН", alert_login_order:"роЖро░рпНроЯро░рпН роЪрпЖропрпНроп роЙро│рпНроирпБро┤рпИропро╡рпБроорпН"},
  te: { nav_home:"р░╣р▒Лр░ор▒Н", nav_dashboard:"р░бр░╛р░╖р▒НтАМр░мр▒Лр░░р▒Нр░бр▒Н", nav_equipment:"р░кр░░р░┐р░Хр░░р░╛р░▓р▒Б", nav_logout:"р░▓р░╛р░Чр▒Н р░Ер░╡р▒Бр░Яр▒Н", nav_login:"р░▓р░╛р░Чр░┐р░ир▒Н", nav_register:"р░░р░┐р░Ьр░┐р░╕р▒Нр░Яр░░р▒Н", sidebar_title:"р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒НтАМр░кр▒Нр░▓р▒Зр░╕р▒Н р░ор▒Жр░ир▒В", sidebar_all_crops:"ЁЯМ▒ р░Ер░ир▒Нр░ир░┐ р░кр░Вр░Яр░▓р▒Б", sidebar_my_orders:"ЁЯУж р░ир░╛ р░Жр░░р▒Нр░бр░░р▒Нр░╕р▒Н", sidebar_insights:"ЁЯУК р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н р░Зр░ир▒Нр░╕р▒Ир░Яр▒Нр░╕р▒Н", main_title:"р░кр░Вр░Яр░▓ р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н", main_lead:"р░╡р▒Нр░пр░╡р░╕р░╛р░пр▒Бр░▓ р░ир▒Бр░Вр░бр░┐ р░ир▒Зр░░р▒Бр░Чр░╛ р░др░╛р░Ьр░╛ р░кр░Вр░Яр░▓р░ир▒Б р░мр▒Нр░░р▒Мр░Ьр▒Н р░Ър▒Зр░╕р░┐ р░Жр░░р▒Нр░бр░░р▒Н р░Ър▒Зр░пр░Вр░бр░┐", loading_crops:"р░кр░Вр░Яр░▓р▒Б р░▓р▒Лр░бр▒Н р░Ер░╡р▒Бр░др▒Бр░ир▒Нр░ир░╛р░пр░┐...", no_crops:"р░П р░кр░Вр░Яр░▓р▒Б р░▓р▒Зр░╡р▒Б.", farmer:"ЁЯСитАНЁЯМ╛ р░░р▒Ир░др▒Б: ", place_order:"р░Жр░░р▒Нр░бр░░р▒Н р░Ър▒Зр░пр░Вр░бр░┐", alert_login_order:"р░Жр░░р▒Нр░бр░░р▒Н р░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░▓р░╛р░Чр░┐р░ир▒Н р░Ър▒Зр░пр░Вр░бр░┐"},
  kn: { nav_home:"р▓╣р│Лр▓ор│Н", nav_dashboard:"р▓бр│Нр▓пр▓╛р▓╢р│НтАМр▓мр│Лр▓░р│Нр▓бр│Н", nav_equipment:"р▓Йр▓кр▓Хр▓░р▓г", nav_logout:"р▓▓р▓╛р▓Чр│Н р▓Фр▓Яр│Н", nav_login:"р▓▓р▓╛р▓Чр▓┐р▓ир│Н", nav_register:"р▓░р▓┐р▓Ьр▓┐р▓╕р│Нр▓Яр▓░р│Н", sidebar_title:"р▓ор▓╛р▓░р│Бр▓Хр▓Яр│Нр▓Яр│Ж р▓ор│Жр▓ир│Б", sidebar_all_crops:"ЁЯМ▒ р▓Ор▓▓р│Нр▓▓р▓╛ р▓мр│Жр▓│р│Жр▓Чр▓│р│Б", sidebar_my_orders:"ЁЯУж р▓ир▓ир│Нр▓и р▓Жр▓░р│Нр▓бр▓░р│НтАМр▓Чр▓│р│Б", sidebar_insights:"ЁЯУК р▓ор▓╛р▓░р│Бр▓Хр▓Яр│Нр▓Яр│Ж р▓Зр▓ир│Нр▓╕р│Ир▓Яр│НтАМр▓Чр▓│р│Б", main_title:"р▓мр│Жр▓│р│Ж р▓ор▓╛р▓░р│Бр▓Хр▓Яр│Нр▓Яр│Ж", main_lead:"р▓Хр│Гр▓╖р▓Хр▓░р▓┐р▓Вр▓ж р▓ир│Зр▓░р▓╡р▓╛р▓Чр▓┐ ╪к╪з╪▓р▓╛ р▓мр│Жр▓│р│Жр▓Чр▓│р▓ир│Нр▓ир│Б р▓мр│Нр▓░р│Мр▓╕р│Н р▓ор▓╛р▓бр▓┐ р▓Жр▓░р│Нр▓бр▓░р│Н р▓ор▓╛р▓бр▓┐", loading_crops:"р▓мр│Жр▓│р│Жр▓Чр▓│р│Б р▓▓р│Лр▓бр│Н р▓Жр▓Чр│Бр▓др│Нр▓др▓┐р▓╡р│Ж...", no_crops:"р▓пр▓╛р▓╡р│Бр▓жр│З р▓мр│Жр▓│р│Жр▓Чр▓│р▓┐р▓▓р│Нр▓▓.", farmer:"ЁЯСитАНЁЯМ╛ р▓░р│Ир▓д: ", place_order:"р▓Жр▓░р│Нр▓бр▓░р│Н р▓ор▓╛р▓бр▓┐", alert_login_order:"р▓Жр▓░р│Нр▓бр▓░р│Н р▓ор▓╛р▓бр▓▓р│Б р▓▓р▓╛р▓Чр▓┐р▓ир│Н р▓ор▓╛р▓бр▓┐"}
};

let lang = localStorage.getItem("lang") || "en";
let L = translations[lang];

function toggleMenu(){ document.getElementById("navbar-links").classList.toggle("show"); }

function logout(){ localStorage.removeItem("user"); location.reload(); }

function renderNavbar(){
  L = translations[localStorage.getItem("lang") || "en"];
  user = JSON.parse(localStorage.getItem("user")||"{}");
  const nav = document.getElementById("navbar-links");
  if(user && user.id){
    nav.innerHTML = `
      <li><a href="index.html">${L.nav_home}</a></li>
      <li><a href="buyer.html">${L.nav_dashboard}</a></li>
      <li><a href="equipment.html">${L.nav_equipment}</a></li>
      <li><a href="#" onclick="logout()">${L.nav_logout}</a></li>`;
  } else {
    nav.innerHTML = `
      <li><a href="index.html">${L.nav_home}</a></li>
      <li><a href="login.html">${L.nav_login}</a></li>
      <li><a href="register.html">${L.nav_register}</a></li>
      <li><a href="equipment.html">${L.nav_equipment}</a></li>`;
  }
}

function applyTranslations(){
  L = translations[localStorage.getItem("lang") || "en"];
  document.title = L.main_title;
  document.getElementById("sidebar-title").textContent = L.sidebar_title;
  document.getElementById("sidebar-all-crops").textContent = L.sidebar_all_crops;
  document.getElementById("sidebar-my-orders").textContent = L.sidebar_my_orders;
  document.getElementById("sidebar-insights").textContent = L.sidebar_insights;
  document.getElementById("main-title").textContent = L.main_title;
  document.getElementById("main-lead").textContent = L.main_lead;
  document.getElementById("list").textContent = L.loading_crops;
  document.getElementById("langSelect").value = localStorage.getItem("lang") || "en";
}

function changeLanguage(){
  const sel = document.getElementById("langSelect").value;
  localStorage.setItem("lang", sel);
  lang = sel;
  applyTranslations();
  renderNavbar();
  load();
}

async function load(){
  const res = await fetch(API + "/crops");
  const data = await res.json();
  const el = document.getElementById("list");
  if(!data || !data.length){ el.innerHTML = `<p>${L.no_crops}</p>`; return; }
  el.innerHTML = data.map((c,i)=>`
    <div class="crop-card" style="animation-delay:${i*0.1}s">
      <div>
        <h3>${c.crop_name}</h3>
        <div class="price">${c.quantity} units @ тВ╣${c.price}</div>
        <small>${L.farmer}${c.farmer_name||"Unknown"}</small>
      </div>
      <button class="btn" onclick="order(${c.id})">${L.place_order}</button>
    </div>`).join("");
}

async function order(cropId){
  user = JSON.parse(localStorage.getItem("user")||"{}");
  if(!user.id){ alert(L.alert_login_order); window.location="login.html"; return; }
  const res = await fetch(API + "/orders", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ crop_id:cropId, buyer_id:user.id })
  });
  const data = await res.json();
  alert(data.message||data.error);
}

window.addEventListener("storage", (e)=>{
  if(e.key==="lang"){ applyTranslations(); renderNavbar(); load(); }
});

// INIT
applyTranslations();
renderNavbar();
load();
</script>
</body>
</html>
