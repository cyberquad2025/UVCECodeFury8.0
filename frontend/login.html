<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriMitra | Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --green:#2d6a4f;
      --dark:#1b4332;
      --light:#d4fc79;
      --white:#fff;
      --bg-gradient: linear-gradient(135deg, #43cea2, #185a9d);
    }

    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--white);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Weather strip */
    .weather-strip {
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      padding:6px 12px;
      background: rgba(0,0,0,0.22);
      font-size:14px;
      flex-wrap:wrap;
    }
    .weather-pill {
      background: rgba(255,255,255,0.12);
      padding:4px 10px;
      border-radius:999px;
      display:inline-flex;
      gap:6px;
      align-items:center;
      font-weight:600;
    }
    .small-muted { opacity:0.9; font-weight:500; }

    /* Navbar */
    nav {
      display:flex;
      justify-content:space-between;
      align-items:center;
      background: rgba(0,0,0,0.18);
      padding:14px 20px;
      position:relative;
    }
    .logo{font-weight:bold; font-size:20px;}
    nav ul{list-style:none; display:flex; gap:20px; margin:0; padding:0; align-items:center;}
    nav a{color:#fff; text-decoration:none; font-weight:600;}
    nav a:hover{ color: var(--light); }
    .menu-toggle{display:none; font-size:26px; cursor:pointer;}
    @media(max-width:768px){
      nav ul{display:none; flex-direction:column; gap:14px; background:rgba(0,0,0,0.9);
             position:absolute; top:100%; left:0; width:100%; padding:18px 0; text-align:center;}
      nav ul.show{display:flex;}
      .menu-toggle{display:block;}
    }

    /* Login card */
    .main {
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:40px 20px;
    }
    .container {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(6px);
      padding: 40px 30px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
      width:100%;
      max-width:380px;
      text-align:center;
      animation: slideIn 0.6s ease;
    }
    @keyframes slideIn {
      from { transform: translateY(30px); opacity:0; }
      to { transform: translateY(0); opacity:1; }
    }
    h2 {
      margin-bottom:24px;
      font-size:28px;
      font-weight:800;
      color: var(--white);
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .logo-icon {
      font-size:42px;
      margin-bottom:10px;
    }
    input, button {
      width:100%;
      padding:14px;
      margin:10px 0;
      border-radius:10px;
      border:none;
      font-size:15px;
      transition:0.2s;
    }
    input { background: rgba(255,255,255,0.9); color:#222; }
    input:focus { box-shadow:0 0 6px rgba(45,106,79,0.5); outline:none; }
    button {
      background: var(--green);
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      transition: 0.3s, transform 0.1s;
    }
    button:hover { background: var(--dark); }
    button:active { transform: scale(0.97); }
    .switch { margin-top:18px; font-size:14px; }
    .switch a { color: var(--light); font-weight:bold; text-decoration:none; }
    .switch a:hover { text-decoration:underline; }
    .error {
      background:#ffe5e5;
      color:#c00;
      padding:10px;
      border-radius:8px;
      font-size:14px;
      margin-bottom:12px;
      display:none;
    }

    @media(max-width:480px){
      .container{padding:30px 20px;}
      h2{font-size:22px;}
    }
  </style>
</head>
<body>

<!-- Weather strip -->
<div class="weather-strip" id="weatherStrip">
  <span class="small-muted">Loading weather‚Ä¶</span>
</div>

<!-- Navbar -->
<nav>
  <div class="logo">üåæ AgriMitra</div>
  <span class="menu-toggle" onclick="toggleMenu()">‚ò∞</span>
  <ul id="navbar-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="marketplace.html">Marketplace</a></li>
    <li><a href="equipment.html">Equipment</a></li>
    <li><a href="signup.html">Signup</a></li>
  </ul>
</nav>

<!-- Login Form -->
<div class="main">
  <div class="container">
    <div class="logo-icon">üåæ</div>
    <h2>Login to AgriMitra</h2>
    <div class="error" id="errorBox"></div>
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <div class="switch">
      <p>Don‚Äôt have an account? <a href="signup.html">Signup here</a></p>
    </div>
  </div>
</div>

<script>
const API = "http://127.0.0.1:5000"; 
const errorBox = document.getElementById("errorBox");

function toggleMenu(){
  document.getElementById("navbar-links").classList.toggle("show");
}

/* Weather */
async function loadWeather(){
  const el = document.getElementById('weatherStrip');
  try{
    const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
    const { latitude:lat, longitude:lon } = pos.coords;
    const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
    const j = await r.json();
    const w = j.current_weather;
    el.innerHTML = `
      <span class="weather-pill">üå°Ô∏è ${Math.round(w.temperature)}¬∞C</span>
      <span class="weather-pill">üí® ${w.windspeed} km/h</span>
    `;
  } catch(e){
    el.innerHTML = "<span class='weather-pill'>‚ö†Ô∏è Weather unavailable</span>";
  }
}
loadWeather();

/* Login form */
document.getElementById("loginForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  errorBox.style.display="none";

  const res = await fetch(API+"/login", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      email: document.getElementById("loginEmail").value,
      password: document.getElementById("loginPassword").value
    })
  });
  const data = await res.json();

  if(data.user){
    localStorage.setItem("user", JSON.stringify(data.user));
    window.location = data.user.role==="farmer" ? "farmer.html" : "buyer.html";
  } else {
    errorBox.innerText = data.error || "‚ùå Login failed. Try again.";
    errorBox.style.display="block";
  }
});
</script>
</body>
</html>
