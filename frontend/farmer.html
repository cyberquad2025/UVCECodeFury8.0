<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AgriMitra | Farmer Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root {
  --green: #2d6a4f;
  --dark: #1b4332;
  --light: #d8f3dc;
  --bg: #f6fff9;
}
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: #222;
}

/* Weather Strip */
.weather-strip {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  padding:8px;
  background: #40916c;
  color:#fff;
  font-size: 14px;
  flex-wrap:wrap;
}
.weather-pill {
  background: rgba(255,255,255,0.2);
  padding:4px 10px;
  border-radius: 999px;
  font-weight:600;
}

/* Navbar */
nav {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background: var(--green);
  color:#fff;
  padding:12px 20px;
  position:relative;
}
.logo { font-size:20px; font-weight:bold; }
nav ul { list-style:none; display:flex; gap:20px; margin:0; padding:0; }
nav a { color:#fff; text-decoration:none; font-weight:500; }
nav a:hover { text-decoration:underline; }
.menu-toggle { display:none; font-size:26px; cursor:pointer; }
@media(max-width:768px){
  nav ul { display:none; flex-direction:column; gap:14px; background:rgba(0,0,0,0.9);
           position:absolute; top:100%; left:0; width:100%; padding:18px 0; text-align:center; }
  nav ul.show { display:flex; }
  .menu-toggle { display:block; }
}

/* Layout */
.container { display:flex; padding:20px; gap:20px; max-width:1200px; margin:auto; }
.sidebar {
  flex:0 0 220px;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  height:fit-content;
}
.sidebar h3 { margin-top:0; color: var(--green); font-size:18px; margin-bottom:10px; }
.sidebar ul { list-style:none; padding:0; margin:0; }
.sidebar li { margin:10px 0; }
.sidebar a { text-decoration:none; color:#333; font-weight:500; }
.sidebar a:hover { color:var(--green); }

.main { flex:1; display:flex; flex-direction:column; gap:20px; }

/* Cards */
.card {
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
.card h2 { margin-top:0; color: var(--green); margin-bottom:15px; }

input, button {
  width:100%;
  padding:12px;
  margin:6px 0;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:14px;
}
input:focus { border-color: var(--green); outline:none; box-shadow:0 0 5px rgba(64,145,108,0.3); }
button {
  background: var(--green);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  border:none;
  transition:0.3s;
}
button:hover { background: var(--dark); }

ul.crops { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; }
ul.crops li {
  padding:12px;
  border:1px solid #eee;
  border-radius:8px;
  background:#f8fdf7;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
}
ul.crops span { font-weight:500; }

/* Language select */
#langSelect { padding:6px; border-radius:6px; font-weight:600; margin-left:10px; }

/* Responsive */
@media(max-width:900px){ .container { flex-direction:column; } .sidebar{ flex:none; } }
@media(max-width:600px){ .card{ padding:16px; } input, button{ font-size:13px; padding:10px; } .sidebar{ padding:16px; } .sidebar h3{ font-size:16px; } }
</style>
</head>
<body>

<!-- Weather -->
<div class="weather-strip" id="weatherStrip"><span>Loading weather...</span></div>

<!-- Navbar -->
<nav>
  <div class="logo">ğŸŒ¾ AgriMitra</div>
  <span class="menu-toggle" onclick="toggleMenu()">â˜°</span>
  <ul id="navbar-links"></ul>
  <select id="langSelect" onchange="changeLanguage()">
    <option value="en">English</option>
    <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
    <option value="ta">à®¤à®®à®¿à®´à¯</option>
    <option value="te">à°¤à±†à°²à±à°—à±</option>
    <option value="kn">à²•à²¨à³à²¨à²¡</option>
  </select>
</nav>

<!-- Layout -->
<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h3 id="menu-title">Farmer Menu</h3>
    <ul>
      <li><a href="#addCrop" id="menu-add">â• Add Crop</a></li>
      <li><a href="#myCrops" id="menu-my">ğŸŒ± My Crops</a></li>
      <li><a href="#insights" id="menu-insights">ğŸ“Š Market Insights</a></li>
    </ul>
  </div>

  <!-- Main content -->
  <div class="main">
    <div class="card" id="addCrop">
      <h2 id="add-title">â• Add New Crop</h2>
      <form id="cropForm">
        <input type="text" id="cropName" placeholder="Crop Name" required>
        <input type="number" id="quantity" placeholder="Quantity" required>
        <input type="number" id="price" placeholder="Price per unit (â‚¹)" required>
        <button type="submit" id="add-btn">Add Crop</button>
      </form>
    </div>

    <div class="card" id="myCrops">
      <h2 id="my-title">ğŸŒ± My Crops</h2>
      <ul class="crops" id="cropsList"></ul>
    </div>

    <div class="card" id="insights">
      <h2 id="insights-title">ğŸ“Š Market Insights</h2>
      <p id="insights-text">Coming soon: price comparison graphs, demand forecasts and more.</p>
    </div>
  </div>
</div>

<script>
const API = "http://127.0.0.1:5000";
let user = JSON.parse(localStorage.getItem("user") || "{}");
if(!user.id || user.role!=="farmer") window.location="index.html";

/* Language support */
const translations = {
  en: { nav_home:"Home", nav_market:"Crop Marketplace", nav_equipment:"Equipment", nav_logout:"Logout", menu:"Farmer Menu", add_title:"â• Add New Crop", add_btn:"Add Crop", my_title:"ğŸŒ± My Crops", insights_title:"ğŸ“Š Market Insights", insights_text:"Coming soon: price comparison graphs, demand forecasts and more." },
  hi: { nav_home:"à¤¹à¥‹à¤®", nav_market:"à¤«à¤¸à¤² à¤®à¤¾à¤°à¥à¤•à¥‡à¤Ÿ", nav_equipment:"à¤‰à¤ªà¤•à¤°à¤£", nav_logout:"à¤²à¥‰à¤—à¤†à¤‰à¤Ÿ", menu:"à¤•à¤¿à¤¸à¤¾à¤¨ à¤®à¥‡à¤¨à¥à¤¯à¥‚", add_title:"â• à¤¨à¤ˆ à¤«à¤¸à¤² à¤œà¥‹à¤¡à¤¼à¥‡à¤‚", add_btn:"à¤œà¥‹à¤¡à¤¼à¥‡à¤‚", my_title:"ğŸŒ± à¤®à¥‡à¤°à¥€ à¤«à¤¸à¤²à¥‡à¤‚", insights_title:"ğŸ“Š à¤®à¤¾à¤°à¥à¤•à¥‡à¤Ÿ à¤‡à¤¨à¤¸à¤¾à¤‡à¤Ÿà¥à¤¸", insights_text:"à¤œà¤²à¥à¤¦ à¤† à¤°à¤¹à¤¾ à¤¹à¥ˆ: à¤•à¥€à¤®à¤¤ à¤¤à¥à¤²à¤¨à¤¾ à¤—à¥à¤°à¤¾à¤«à¤¼, à¤®à¤¾à¤‚à¤— à¤ªà¥‚à¤°à¥à¤µà¤¾à¤¨à¥à¤®à¤¾à¤¨ à¤”à¤° à¤…à¤§à¤¿à¤•à¥¤" },
  ta: { nav_home:"à®®à¯à®•à®ªà¯à®ªà¯", nav_market:"à®ªà®¯à®¿à®°à¯ à®šà®¨à¯à®¤à¯ˆ", nav_equipment:"à®šà®¾à®¤à®©à®™à¯à®•à®³à¯", nav_logout:"à®µà¯†à®³à®¿à®¯à¯‡à®±à¯", menu:"à®µà®¿à®µà®šà®¾à®¯à®¿ à®®à¯†à®©à¯", add_title:"â• à®ªà¯à®¤à®¿à®¯ à®ªà®¯à®¿à®°à¯ à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯", add_btn:"à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯", my_title:"ğŸŒ± à®à®©à¯ à®ªà®¯à®¿à®°à¯à®•à®³à¯", insights_title:"ğŸ“Š à®šà®¨à¯à®¤à¯ˆ à®…à®±à®¿à®µà¯à®°à¯ˆà®•à®³à¯", insights_text:"à®µà®¿à®°à¯ˆà®µà®¿à®²à¯: à®µà®¿à®²à¯ˆ à®’à®ªà¯à®ªà¯€à®Ÿà¯ à®µà®°à¯ˆà®ªà®Ÿà®™à¯à®•à®³à¯, à®¤à¯‡à®µà¯ˆà®•à¯ à®•à®£à®¿à®ªà¯à®ªà¯à®•à®³à¯ à®®à®±à¯à®±à¯à®®à¯ à®®à¯‡à®²à¯à®®à¯." },
  te: { nav_home:"à°¹à±‹à°®à±", nav_market:"à°ªà°‚à°Ÿ à°®à°¾à°°à±à°•à±†à°Ÿà±", nav_equipment:"à°ªà°°à°¿à°•à°°à°¾à°²à±", nav_logout:"à°²à°¾à°—à± à°…à°µà±à°Ÿà±", menu:"à°°à±ˆà°¤à± à°®à±†à°¨à±‚", add_title:"â• à°•à±Šà°¤à±à°¤ à°ªà°‚à°Ÿ à°šà±‡à°°à±à°šà±", add_btn:"à°šà±‡à°°à±à°šà±", my_title:"ğŸŒ± à°¨à°¾ à°ªà°‚à°Ÿà°²à±", insights_title:"ğŸ“Š à°®à°¾à°°à±à°•à±†à°Ÿà± à°¸à°®à°¾à°šà°¾à°°à°¾à°²à±", insights_text:"à°šà°¿à°¨à±à°¨ à°•à°¾à°²à°‚à°²à±‹: à°§à°°à°² à°¸à°°à°¿à°ªà±‹à°²à°¿à°• à°—à±à°°à°¾à°«à±â€Œà°²à±, à°¡à°¿à°®à°¾à°‚à°¡à± à°…à°‚à°šà°¨à°¾à°²à± à°®à°°à°¿à°¯à± à°®à°°à°¿à°¨à±à°¨à°¿." },
  kn: { nav_home:"à²¹à³‹à²®à³", nav_market:"à²¹à²£à²¿à²•à³Šà²¡à³ à²®à²¾à²°à³à²•à²Ÿà³à²Ÿà³†", nav_equipment:"à²‰à²ªà²•à²°à²£", nav_logout:"à²²à²¾à²—à³ à²”à²Ÿà³", menu:"à²°à³ˆà²¤ à²®à³†à²¨à³", add_title:"â• à²¹à³Šà²¸ à²¬à³†à²³à³† à²¸à³‡à²°à²¿à²¸à²¿", add_btn:"à²¸à³‡à²°à²¿à²¸à²¿", my_title:"ğŸŒ± à²¨à²¨à³à²¨ à²¬à³†à²³à³†à²—à²³à³", insights_title:"ğŸ“Š à²®à²¾à²°à³à²•à²Ÿà³à²Ÿà³† à²®à²¾à²¹à²¿à²¤à²¿", insights_text:"à²¬à²—à³à²—à³† à²¬à²°à³à²¤à³à²¤à²¿à²¦à³†: à²¬à³†à²²à³† à²¹à³‹à²²à²¿à²•à³† à²—à³à²°à²¾à²«à³â€Œà²—à²³à³, à²¬à³‡à²¡à²¿à²•à³†à²¯ à²…à²‚à²¦à²¾à²œà³ à²®à²¤à³à²¤à³ à²‡à²¨à³à²¨à²·à³à²Ÿà³." }
};
let lang = localStorage.getItem("lang") || "en";
let L = translations[lang];

/* Apply language */
function applyTranslations(){
  L = translations[localStorage.getItem("lang")||"en"];
  document.getElementById("langSelect").value = lang;
  document.getElementById("menu-title").textContent = L.menu;
  document.getElementById("add-title").textContent = L.add_title;
  document.getElementById("add-btn").textContent = L.add_btn;
  document.getElementById("my-title").textContent = L.my_title;
  document.getElementById("insights-title").textContent = L.insights_title;
  document.getElementById("insights-text").textContent = L.insights_text;
  renderNavbar();
}

/* Change language */
function changeLanguage(){
  lang = document.getElementById("langSelect").value;
  localStorage.setItem("lang", lang);
  applyTranslations();
}

/* Navbar rendering */
function renderNavbar(){
  const nav = document.getElementById("navbar-links");
  nav.innerHTML = `<li><a href="index.html">${L.nav_home}</a></li>
                   <li><a href="marketplace.html">${L.nav_market}</a></li>
                   <li><a href="equipment.html">${L.nav_equipment}</a></li>
                   <li><a href="#" onclick="logout()">${L.nav_logout}</a></li>`;
}

/* Navbar toggle */
function toggleMenu(){ document.getElementById("navbar-links").classList.toggle("show"); }

/* Logout */
function logout(){ localStorage.removeItem("user"); window.location="index.html"; }

/* Add Crop */
document.getElementById("cropForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const res = await fetch(API+"/crops", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      farmer_id: user.id,
      crop_name: document.getElementById("cropName").value,
      quantity: +document.getElementById("quantity").value,
      price: +document.getElementById("price").value
    })
  });
  const data = await res.json();
  alert(data.message || data.error);
  document.getElementById("cropForm").reset();
  loadCrops();
});

/* Load crops */
async function loadCrops(){
  const res = await fetch(API+"/crops?farmer_id="+user.id);
  const crops = await res.json();
  document.getElementById("cropsList").innerHTML = crops.map(c=>`<li><span>${c.crop_name} - ${c.quantity} units @ â‚¹${c.price}</span></li>`).join("");
}

/* Weather */
async function loadWeather(){
  const el = document.getElementById('weatherStrip');
  try{
    const pos = await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej));
    const {latitude:lat,longitude:lon} = pos.coords;
    const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
    const j = await r.json();
    const w = j.current_weather;
    el.innerHTML = `<span class="weather-pill">ğŸŒ¡ï¸ ${Math.round(w.temperature)}Â°C</span>
                    <span class="weather-pill">ğŸ’¨ ${w.windspeed} km/h</span>`;
  }catch(e){ el.innerHTML = "<span>Weather unavailable</span>"; }
}

/* Init */
applyTranslations();
loadCrops();
loadWeather();
</script>
</body>
</html>
